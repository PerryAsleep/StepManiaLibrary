# PerformedChart

`PerformedCharts` represent a performance of steps for a specific [ChartType](ChartType.md). They are used for two purposes:
1. Full chart generation
	- In this case, `PerformedCharts` are generated by applying the moves from an [ExpressedChart](ExpressedChart.md) representation of a source chart to the destination [ChartType](ChartType.md)'s [StepGraph](StepGraphs.md) using the rules from a [PerformedChart Configuration](#performedchart-configuration). All possible paths through the chart are searched and the best is chosen.
2. Pattern generation within an existing chart
	- In this case, `PerformedCharts` representing a region within a chart are generated by examining [ExpressedChart](ExpressedChart.md) representations of the preceding and following steps, and filling steps using both a [Pattern Configuration](Pattern.md) and a [PerformedChart Configuration](#performedchart-configuration). As with full chart generation, all possible paths are searched and the best is chosen.

# PerformedChart Determination

When comparing paths for a `PerformedChart` a series of comparisons are made to determine the best path.
1. Fallbacks
	- Paths with the fewest [StepType Fallbacks](StepTypeFallbacks.md) are preferred.
2. Misleading Steps
	- Paths with the fewest number of misleading steps are preferred. A misleading step is a step which a reasonable player would interpret incorrectly.
3. Ambiguous Steps
	- Paths with the fewest number of ambiguous steps are preferred. An ambiguous step is a step which could be performed with more than one equally valid choice.
4. (Pattern Generation Only) Repetition Limits
	- Paths with the fewest number of `SameArrow` steps per foot in a row that exceed specified limits are preferred.
5. Stretch
	- Paths with the least aggressive stretch are preferred. Wider stretch is considered more aggressive. See [Stretch Tightening](StepTighteningControls.md#stretch-tightening) for configuring or disabling this check.
6. Facing
	- Paths which exceed desired bounds for facing the body inward or outward are preferred less. See [Facing Controls](FacingControls.md) for configuring or disabling this check. 
7. Individual Step Distance
	- Paths with lower individual step distances are preferred. See [Distance Tightening](StepTighteningControls.md#distance-tightening) for configuring or disabling this check.
8. Individual Step Speed
	- Paths with lower individual step speeds are preferred. See [Speed Tightening](StepTighteningControls.md#speed-tightening) for configuring or disabling this check.
9. (Pattern Generation Only) [StepType](StepTypes.md) Distribution
	- Paths which most closely match the desired distribution of `NewArrow` and `SameArrow` steps are preferred.
10. Lateral Movement Speed
	- Paths with the least aggressive lateral movement are preferred. See [Lateral Tightening](LateralTighteningControls.md) for configuring or disabling this check.
11. Frequent Transitions
	- Paths which result in transitions more frequently than desired are penalized. See [Transition Controls](TransitionControls.md) for configuring or disabling this check.
12. Infrequent Transitions
	- Paths which result in transitions less frequently than desired are penalized. See [Transition Controls](TransitionControls.md) for configuring or disabling this check.
13. Arrow Distribution
	- Paths which more closely match the desired arrow distribution are preferred. See [Arrow Weights](#arrowweights) below for configuring this behavior.
14. Random Weights
	- Failing all above checks, paths are chosen randomly.

## Pattern Determination

When `PerformedCharts` are used to generate patterns there are additional restrictions on path choices described below:
- The pattern will always start only at valid starting locations specified by the [Pattern Configuration](Pattern.md).
- Paths with both feet ending at desired locations specified by the [Pattern Configuration](Pattern.md) will be preferred.
	- If this would result in no valid paths, paths with one foot ending at the desired location are preferred.
	- If that would also result in no valid paths then no restriction is put on the final positions.

# PerformedChart Configuration

`PerformedChart` behavior can be configured through json objects described below.

## Example Configuration

<details>
	<summary>Example</summary>

```json5
{
	"ArrowWeights":
	{
		"dance-single": [25, 25, 25, 25],
		"dance-double": [6, 12, 10, 22, 22, 12, 10, 6],
		"dance-solo": [13, 12, 25, 25, 12, 13],
		"dance-threepanel": [25, 50, 25],

		"pump-single": [17, 16, 34, 16, 17],
		"pump-halfdouble": [25, 12, 13, 13, 12, 25],
		"pump-double": [4, 4, 17, 12, 13, 13, 12, 17, 4, 4],

		"smx-beginner": [25, 50, 25],
		"smx-single": [25, 21, 8, 21, 25],
		"smx-dual": [8, 17, 25, 25, 17, 8],
		"smx-full": [6, 8, 7, 8, 22, 22, 8, 7, 8, 6],
	},

	"StepTightening":
	{
		// Laterally, consider a foot moving 1/6 into a panel as the minimum distance to trigger it.
		"LateralMinPanelDistance": 0.166667,
		// Longitudinally, consider a foot moving 1/8 outside of a panel as the minimum distance to trigger it.
		"LongitudinalMinPanelDistance": -0.125,
		
		// Enable distance tightening.
		"DistanceTighteningEnabled": true,
		// With the above min panel distance values, 1.4 will:
		// - Allow a 2X1Y move.
		// - Penalize a 2X2Y move.
		// - Penalize a 3X move.
		// - Penalize a bracket move moving an average of 2 panels.
		"DistanceMin": 1.4,
		// 2 1/3 is the cutoff for 3 panel stretch in X.
		"DistanceMax": 2.333333,

		// Enable speed tightening.
		"SpeedTighteningEnabled": true,
		// Stop increasing costs at 16th notes at 170bpm.
		"SpeedMinTimeSeconds": 0.176471,
		// Start limiting at 16th notes at 125bpm.
		"SpeedMaxTimeSeconds": 0.24,
		// Do not use a distance cutoff for speed tightening.
		"SpeedTighteningMinDistance": 0.0,

		// Enable stretch tightening.
		"StretchTighteningEnabled": true,
		// Start limiting stretch moves at 2 1/3, which is a 3 panel move in X.
		"StretchDistanceMin": 2.333333,
		// Stop increasing costs for stretch moves at 3 1/3 which is a 4 panel move in X.
		"StretchDistanceMax": 3.333333,
	},

	"LateralTightening":
	{
		// Enable lateral tightening.
		"Enabled": true,
		// Penalize lateral movement steps that are 1.65 times as dense as the chart average.
		"RelativeNPS": 1.65,
		// Penalize lateral movement steps that are over 12 notes per second.
		"AbsoluteNPS": 12.0,
		// The body must be moving at least 3 arrow widths per second for lateral tightening to penalize steps.
		"Speed": 3.0,
	},

	"Facing":
	{
		// Do not penalize inward facing steps.
		"MaxInwardPercentage": 1.0,
		"InwardPercentageCutoff": 0.5,
		// Do not penalize outward facing steps.
		"MaxOutwardPercentage": 1.0,
		"OutwardPercentageCutoff": 0.5,
	},

	"Transitions":
	{
		// Do not enable transition limits.
		"Enabled": false,
	},
},
```
</details>

## `ArrowWeights`

```json5
{
	"dance-single": [25, 25, 25, 25],
	"dance-double": [6, 12, 10, 22, 22, 12, 10, 6],
	"dance-solo": [13, 12, 25, 25, 12, 13],
	"dance-threepanel": [25, 50, 25],

	"pump-single": [17, 16, 34, 16, 17],
	"pump-halfdouble": [25, 12, 13, 13, 12, 25],
	"pump-double": [4, 4, 17, 12, 13, 13, 12, 17, 4, 4],

	"smx-beginner": [25, 50, 25],
	"smx-single": [25, 21, 8, 21, 25],
	"smx-dual": [8, 17, 25, 25, 17, 8],
	"smx-full": [6, 8, 7, 8, 22, 22, 8, 7, 8, 6],
},
```

Object type. Each value in this object is a key-value pair. The key is a string representing a [ChartType](ChartType.md) and the value is an array of integers representing the desired weights per lane for that type. When generating charts `ArrowWeights` is used to control, for each lane, what percentage of the chart's steps should fall in that lane. The values do not need to sum to 100. They will be compared against each other and normalized when used to generate charts.

## `StepTightening`

See [Step Tightening Controls](StepTighteningControls.md). Step tightening controls include:
- [Distance Tightening](StepTighteningControls.md#distance-tightening)
- [Speed Tightening](StepTighteningControls.md#speed-tightening)
- [Stretch Tightening](StepTighteningControls.md#stretch-tightening)

## `LateralTightening`

See [Lateral Tightening Controls](LateralTighteningControls.md).

## `Facing`

See [Facing Controls](FacingControls.md).

## `Transitions`

See [Transition Controls](TransitionControls.md).