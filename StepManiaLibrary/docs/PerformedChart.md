# PerformedChart

`PerformedCharts` represent a performance of an [ExpressedChart](ExpressedChart.md) for specific [ChartType](ChartType.md). `PerformedCharts` are generated by applying the moves from an `ExpressedChart` to the `ChartTypes`'s [Step Graph](StepGraphs.md). All possible paths through the chart are searched and the best is chosen.

# PerformedChart Determination

When comparing paths through a chart a series of comparisons are made to determine the best path.
1. Fallbacks
	- Paths with the fewest `StepType` fallbacks are preferred. See [StepType Fallbacks](StepTypeFallbacks.md) for details.
2. Misleading Steps
	- Paths with the fewest number of misleading steps are preferred. A misleading step is a step which a reasonable player would interpret incorrectly, for example a jump with two feet on the same two arrows that were just intended to be hit by one foot with a bracket. Any reasonable player would bracket again.
3. Ambiguous Steps
	- Paths with the fewest number of ambiguous steps are preferred. An ambiguous step is a step which could be performed with more than one equally valid choice. For example after a jump, stepping on a new arrow that is of equal distance between the two arrows that were jumped on.
4. Stretch
	- Paths with the least aggressive stretch are preferred. Wider stretch is considered more aggressive. See [Stretch Distance](#stretch-distance) below for configuring or disabling this check
5. Facing
	- Paths which exceed desired bounds for facing the body inward or outward are preferred less. See [Facing Controls](FacingControls.md) for configuring or disabling this check. 
6. Individual Step Travel Distance
	- Paths with lower individual step distances are preferred. See [Travel Distance](#travel-distance) below for configuring or disabling this check.
7. Individual Step Travel Speed
	- Paths with lower individual step speeds are preferred. See [Travel Speed](#travel-speed) below for configuring or disabling this check.
8. Lateral Movement Speed
	- Paths with the least aggressive lateral movement are preferred. See [Lateral Tightening](LateralTighteningControls.md) for configuring or disabling this check.
9. Frequent Transitions
	- Paths which result in transitions more frequently than desired are penalized. See [Transition Controls](TransitionContols.md) for configuring or disabling this check.
10. Infrequent Transitions
	- Paths which result in transitions less frequently than desired are penalized. See [Transition Controls](TransitionContols.md) for configuring or disabling this check.
11. Arrow Distribution
	- Paths which more closely match the desired arrow distribution are preferred. See [Arrow Weights](#arrow-weights) below for configuring this behavior.

# PerformedChart Configuration

`PerformedChart` behavior can be configured through json objects described below.

## Example Configuration

```json
{
	"ArrowWeights":
	{
		"dance-single": [25, 25, 25, 25],
		"dance-double": [6, 12, 10, 22, 22, 12, 10, 6],
		"dance-solo": [13, 12, 25, 25, 12, 13],
		"dance-threepanel": [25, 50, 25],

		"pump-single": [17, 16, 34, 16, 17],
		"pump-halfdouble": [25, 12, 13, 13, 12, 25],
		"pump-double": [4, 4, 17, 12, 13, 13, 12, 17, 4, 4],

		"smx-beginner": [25, 50, 25],
		"smx-single": [25, 21, 8, 21, 25],
		"smx-dual": [8, 17, 25, 25, 17, 8],
		"smx-full": [6, 8, 7, 8, 22, 22, 8, 7, 8, 6],
	},

	"StepTightening":
	{
		"TravelSpeedMinTimeSeconds": 0.176471,	// 16ths at 170
		"TravelSpeedMaxTimeSeconds": 0.24,		// 16ths at 125
		"TravelDistanceMin": 2.5,
		"TravelDistanceMax": 4.0,
		"StretchDistanceMin": 3.0,
		"StretchDistanceMax": 4.0,
		"DistanceCompensationX": 0.0,
		"DistanceCompensationY": 0.5,
	},

	"LateralTightening":
	{
		// Enable lateral tightening.
		"Enabled": true,
		// Penalize lateral movement steps that are 1.65 times as dense as the chart average.
		"RelativeNPS": 1.65,
		// Penalize lateral movement steps that are over 12 notes per second.
		"AbsoluteNPS": 12.0,
		// The body must be moving at least 3 arrow widths per second for lateral tightening to penalize steps.
		"Speed": 3.0,
	},

	"Facing":
	{
		// Do not penalize inward facing steps.
		"MaxInwardPercentage": 1.0,
		"InwardPercentageCutoff": 0.5,
		// Do not penalize outward facing steps.
		"MaxOutwardPercentage": 1.0,
		"OutwardPercentageCutoff": 0.5,
	},

	"Transitions":
	{
		// Enable transition limits.
		"Enabled": true,
		// Prefer steps which do not transition more than once every two measures.
		"StepsPerTransitionMin": 32,
		// Do not penalize slow transitions.
		"StepsPerTransitionMax": 1024,
		// Don't limit transitions for narrow ChartTypes.
		"MinimumPadWidth": 5,
		// Consider a transition to be moving from one half of the pads to the other half.
		"TransitionCutoffPercentage": 0.5,
	}
},
```

## Arrow Weights

Object type. Each value in this object is a key value pair. The key is a string representing a [ChartType](ChartType.md) and the value is an array of integers representing the desired weights per lane for that type. When generating charts for the specified `OutputChartType`, `DesiredArrowWeights` is used to control, for each lane, what percentage of the chart's steps should fall in that lane. For example, for doubles it is desirable to follow a bell-like curve with more steps on the middles than on the outer arrows. To specify this you could specify `"dance-double": [6, 12, 10, 22, 22, 12, 10, 6]`. The values do not need to sum to 100. They will be compared against each other and normalized when used to generate charts.

## Step Tightening

### Travel Speed

Travel speed tightening can be disabled by setting `TravelSpeedMinTimeSeconds` to `0.0`.

`TravelSpeedMinTimeSeconds` and `TravelSpeedMaxTimeSeconds` represent a range of times in seconds between steps for one foot. If a step is faster (lower) than `TravelSpeedMaxTimeSeconds` then it will have a cost assigned to it based on its speed. Speed is determined by both the time of the step, and the distance of the step. The speed of a step is weighted based on where its time falls within the range defined by these values. The same step movement taking place over a time closer to `TravelSpeedMaxTimeSeconds` will have a lower cost than it would if it took place over a time closer to `TravelSpeedMinTimeSeconds`. Steps which take longer than `TravelSpeedMaxTimeSeconds` will have no individual step tightening cost. Steps which take shorter than `TravelSpeedMinTimeSeconds` will all be considered equally fast, though larger movements at this speed will still be considered more costly than shorter movements.

For example, to configure the application to apply weights based on individual steps starting at 16th notes at 125bpm and peaking at 16th notes at 170bpm set `TravelSpeedMaxTimeSeconds` to `0.24` and `TravelSpeedMinTimeSeconds` to `0.176471`.

```
(60 seconds per minute / (4 notes per beat x 125 beats per minute)) x 2 feet) = 0.24 seconds
(60 seconds per minute / (4 notes per beat x 170 beats per minute)) x 2 feet) = 0.176471 seconds
```

Note the extra multiplication by 2 feet in the above math since in a 16th note pattern each foot is actually moving at half that speed (each foot hits with eighth note frequency).

- **TravelSpeedMinTimeSeconds**: Number (double) type. Time in seconds between steps for one foot. See above explanation.
- **TravelSpeedMaxTimeSeconds**: Number (double) type. Time in seconds between steps for one foot. See above explanation.

### Travel Distance

Travel distance tightening can be disabled by setting `TravelDistanceMax` to `0.0`.

`TravelDistanceMin` and `TravelDistanceMax` represent a range of distances in panel lengths. If an individual step moves greater than `TravelDistanceMin` in one step then it will have a cost associated with it. This cost will be scaled by the distance magnitude up to `TravelDistanceMax`, beyond which all distances will use the same cost.

Travel distance calculation takes into account the specified `DistanceCompensationX` and `DistanceCompensationY` values.

- **TravelDistanceMin**: Number (double) type. Distance in panel lengths. See above explanation.
- **TravelDistanceMax**: Number (double) type. Distance in panel lengths. See above explanation.

### Stretch Distance

Stretch distance tightening can be disabled by setting `StretchDistanceMax` to `0.0`.

`StretchDistanceMin` and `StretchDistanceMax` represent a range of distances in panel lengths. If an individual stretch step moves greater than `StretchDistanceMin` in one step then it will have a cost associated with it. This cost will be scaled by the distance magnitude up to `StretchDistanceMax`, beyond which all distances will use the same cost.

Stretch distance calculation takes into account the specified `DistanceCompensationX` and `DistanceCompensationY` values.

- **StretchDistanceMin**: Number (double) type. Distance in panel lengths. See above explanation.
- **StretchDistanceMax**: Number (double) type. Distance in panel lengths. See above explanation.

### Distance Compensation

Values can be defined to shorten distances in one dimension for the distance calculations performed with other `StepTightening` options by setting `DistanceCompensationX` or `DistanceCompensationY` to non-zero values. This can be useful when wanting to treat movements between arrows in one dimension as taking less movement than movements of equal length in another dimension, which may be preferable given that a foot typically has to move less distance in Y than it does in X to move between equally spaced arrows because a foot is significantly longer than it is wide.

- **DistanceCompensationX**: Number (double) type. Value to subtract from X distances in `StepTightening` calculations.
- **DistanceCompensationY**: Number (double) type. Value to subtract from Y distances in `StepTightening` calculations.

## LateralTightening

See [Lateral Tightening Controls](LateralTighteningControls.md).

## Facing

See [Facing Controls](FacingControls.md).

## Transitions
See [Transition Controls](TransitionControls.md).