# PerformedChart

`PerformedCharts` represent a performance of an [ExpressedChart](ExpressedChart.md) for specific [ChartType](ChartType.md). `PerformedCharts` are generated by applying the moves from an `ExpressedChart` to the `ChartTypes`'s [StepGraph](StepGraphs.md). All possible paths through the chart are searched and the best is chosen.

# PerformedChart Determination

When comparing paths through a chart a series of comparisons are made to determine the best path.
1. Fallbacks
	- Paths with the fewest `StepType` fallbacks are preferred. See [StepType Fallbacks](StepTypeFallbacks.md) for details.
2. Misleading Steps
	- Paths with the fewest number of misleading steps are preferred. A misleading step is a step which a reasonable player would interpret incorrectly.
3. Ambiguous Steps
	- Paths with the fewest number of ambiguous steps are preferred. An ambiguous step is a step which could be performed with more than one equally valid choice.
4. Stretch
	- Paths with the least aggressive stretch are preferred. Wider stretch is considered more aggressive. See [Stretch Tightening](StepTighteningControls.md#stretch-tightening) for configuring or disabling this check.
5. Facing
	- Paths which exceed desired bounds for facing the body inward or outward are preferred less. See [Facing Controls](FacingControls.md) for configuring or disabling this check. 
6. Individual Step Distance
	- Paths with lower individual step distances are preferred. See [Distance Tightening](StepTighteningControls.md#distance-tightening) for configuring or disabling this check.
7. Individual Step Speed
	- Paths with lower individual step speeds are preferred. See [Speed Tightening](StepTighteningControls.md#speed-tightening) for configuring or disabling this check.
8. Lateral Movement Speed
	- Paths with the least aggressive lateral movement are preferred. See [Lateral Tightening](LateralTighteningControls.md) for configuring or disabling this check.
9. Frequent Transitions
	- Paths which result in transitions more frequently than desired are penalized. See [Transition Controls](TransitionControls.md) for configuring or disabling this check.
10. Infrequent Transitions
	- Paths which result in transitions less frequently than desired are penalized. See [Transition Controls](TransitionControls.md) for configuring or disabling this check.
11. Arrow Distribution
	- Paths which more closely match the desired arrow distribution are preferred. See [Arrow Weights](#arrow-weights) below for configuring this behavior.

# PerformedChart Configuration

`PerformedChart` behavior can be configured through json objects described below.

## Example Configuration

<details>
	<summary>Example</summary>

```json5
{
	"ArrowWeights":
	{
		"dance-single": [25, 25, 25, 25],
		"dance-double": [6, 12, 10, 22, 22, 12, 10, 6],
		"dance-solo": [13, 12, 25, 25, 12, 13],
		"dance-threepanel": [25, 50, 25],

		"pump-single": [17, 16, 34, 16, 17],
		"pump-halfdouble": [25, 12, 13, 13, 12, 25],
		"pump-double": [4, 4, 17, 12, 13, 13, 12, 17, 4, 4],

		"smx-beginner": [25, 50, 25],
		"smx-single": [25, 21, 8, 21, 25],
		"smx-dual": [8, 17, 25, 25, 17, 8],
		"smx-full": [6, 8, 7, 8, 22, 22, 8, 7, 8, 6],
	},

	"StepTightening":
	{
		// Laterally, consider a foot moving 1/6 into a panel as the minimum distance to trigger it.
		"LateralMinPanelDistance": 0.166667,
		// Longitudinally, consider a foot moving 1/8 outside of a panel as the minimum distance to trigger it.
		"LongitudinalMinPanelDistance": -0.125,
		
		// Enable distance tightening.
		"DistanceTighteningEnabled": true,
		// With the above min panel distance values, 1.4 will:
		// - Allow a 2X1Y move.
		// - Penalize a 2X2Y move.
		// - Penalize a 3X move.
		// - Penalize a bracket move moving an average of 2 panels.
		"DistanceMin": 1.4,
		// 2 1/3 is the cutoff for 3 panel stretch in X.
		"DistanceMax": 2.333333,

		// Enable speed tightening.
		"SpeedTighteningEnabled": true,
		// Stop increasing costs at 16th notes at 170bpm.
		"SpeedMinTimeSeconds": 0.176471,
		// Start limiting at 16th notes at 125bpm.
		"SpeedMaxTimeSeconds": 0.24,
		// Do not use a distance cutoff for speed tightening.
		"SpeedTighteningMinDistance": 0.0,

		// Enable stretch tightening.
		"StretchTighteningEnabled": true,
		// Start limiting stretch moves at 2 1/3, which is a 3 panel move in X.
		"StretchDistanceMin": 2.333333,
		// Stop increasing costs for stretch moves at 3 1/3 which is a 4 panel move in X.
		"StretchDistanceMax": 3.333333,
	},

	"LateralTightening":
	{
		// Enable lateral tightening.
		"Enabled": true,
		// Penalize lateral movement steps that are 1.65 times as dense as the chart average.
		"RelativeNPS": 1.65,
		// Penalize lateral movement steps that are over 12 notes per second.
		"AbsoluteNPS": 12.0,
		// The body must be moving at least 3 arrow widths per second for lateral tightening to penalize steps.
		"Speed": 3.0,
	},

	"Facing":
	{
		// Do not penalize inward facing steps.
		"MaxInwardPercentage": 1.0,
		"InwardPercentageCutoff": 0.5,
		// Do not penalize outward facing steps.
		"MaxOutwardPercentage": 1.0,
		"OutwardPercentageCutoff": 0.5,
	},

	"Transitions":
	{
		// Do not enable transition limits.
		"Enabled": false,
	},
},
```
</details>

## `ArrowWeights`

```json5
{
	"dance-single": [25, 25, 25, 25],
	"dance-double": [6, 12, 10, 22, 22, 12, 10, 6],
	"dance-solo": [13, 12, 25, 25, 12, 13],
	"dance-threepanel": [25, 50, 25],

	"pump-single": [17, 16, 34, 16, 17],
	"pump-halfdouble": [25, 12, 13, 13, 12, 25],
	"pump-double": [4, 4, 17, 12, 13, 13, 12, 17, 4, 4],

	"smx-beginner": [25, 50, 25],
	"smx-single": [25, 21, 8, 21, 25],
	"smx-dual": [8, 17, 25, 25, 17, 8],
	"smx-full": [6, 8, 7, 8, 22, 22, 8, 7, 8, 6],
},
```

Object type. Each value in this object is a key value pair. The key is a string representing a [ChartType](ChartType.md) and the value is an array of integers representing the desired weights per lane for that type. When generating charts `ArrowWeights` is used to control, for each lane, what percentage of the chart's steps should fall in that lane. The values do not need to sum to 100. They will be compared against each other and normalized when used to generate charts.

## `StepTightening`

See [Step Tightening Controls](StepTighteningControls.md). Step tightening controls include:
- [Distance Tightening](StepTighteningControls.md#distance-tightening)
- [Speed Tightening](StepTighteningControls.md#speed-tightening)
- [Stretch Tightening](StepTighteningControls.md#stretch-tightening)

## `LateralTightening`

See [Lateral Tightening Controls](LateralTighteningControls.md).

## `Facing`

See [Facing Controls](FacingControls.md).

## `Transitions`

See [Transition Controls](TransitionControls.md).
